#!/usr/bin/env bash
# SEAL E2E defaults (auto-loaded by E2E scripts via bash source; use trusted files only).
# Copy to .seal/e2e.env to override per-repo without touching this file.

# Docker E2E
SEAL_DOCKER_E2E_REMOTE="${SEAL_DOCKER_E2E_REMOTE:-1}"
SEAL_DOCKER_E2E_REMOTE_FALLBACK="${SEAL_DOCKER_E2E_REMOTE_FALLBACK:-1}"
SEAL_DOCKER_E2E_PULL="${SEAL_DOCKER_E2E_PULL:-0}"
SEAL_DOCKER_E2E_BUILDER="${SEAL_DOCKER_E2E_BUILDER:-full}"
SEAL_DOCKER_E2E_REBUILD="${SEAL_DOCKER_E2E_REBUILD:-0}"
SEAL_DOCKER_E2E_CACHE_DIR="${SEAL_DOCKER_E2E_CACHE_DIR:-$PWD/seal-out/e2e/cache/docker}"
SEAL_DOCKER_E2E_PROGRESS="${SEAL_DOCKER_E2E_PROGRESS:-plain}"
SEAL_DOCKER_E2E_SAVE_IMAGE="${SEAL_DOCKER_E2E_SAVE_IMAGE:-1}"
SEAL_DOCKER_E2E_BUILD_NETWORK="${SEAL_DOCKER_E2E_BUILD_NETWORK:-host}"
SEAL_DOCKER_E2E_BUILD_NETWORK_FALLBACK="${SEAL_DOCKER_E2E_BUILD_NETWORK_FALLBACK:-default}"
SEAL_DOCKER_E2E_CGROUPNS="${SEAL_DOCKER_E2E_CGROUPNS:-host}"
SEAL_DOCKER_E2E_SHM_SIZE="${SEAL_DOCKER_E2E_SHM_SIZE:-2g}"
SEAL_DOCKER_E2E_IPC="${SEAL_DOCKER_E2E_IPC:-}"
SEAL_DOCKER_E2E_SSHD_TIMEOUT="${SEAL_DOCKER_E2E_SSHD_TIMEOUT:-60}"
# Set to 1 to run host-only tests inside privileged Docker E2E.
SEAL_DOCKER_E2E_HOST="${SEAL_DOCKER_E2E_HOST:-0}"
SEAL_E2E_TOOLSET="${SEAL_E2E_TOOLSET:-core}"

# Share example node_modules across runs to avoid re-install.
SEAL_E2E_USE_SHARED_NODE_MODULES="${SEAL_E2E_USE_SHARED_NODE_MODULES:-1}"

# Thin cache retention (avoid frequent prunes during E2E runs).
SEAL_THIN_CACHE_LIMIT="${SEAL_THIN_CACHE_LIMIT:-6}"

# Parallelism
SEAL_E2E_PARALLEL="${SEAL_E2E_PARALLEL:-1}"
SEAL_E2E_PARALLEL_MODE="${SEAL_E2E_PARALLEL_MODE:-per-test}"
SEAL_E2E_JOBS="${SEAL_E2E_JOBS:-}"

# Dependency installs (leave empty for auto-detect)
SEAL_E2E_INSTALL_DEPS="${SEAL_E2E_INSTALL_DEPS:-}"
SEAL_E2E_INSTALL_PACKERS="${SEAL_E2E_INSTALL_PACKERS:-}"
SEAL_E2E_INSTALL_OBFUSCATORS="${SEAL_E2E_INSTALL_OBFUSCATORS:-}"
SEAL_E2E_INSTALL_EXAMPLE_DEPS="${SEAL_E2E_INSTALL_EXAMPLE_DEPS:-}"

# Force rebuilds (set to 1 to recompile)
SEAL_E2E_REINSTALL_PACKERS="${SEAL_E2E_REINSTALL_PACKERS:-0}"
SEAL_E2E_REINSTALL_OBFUSCATORS="${SEAL_E2E_REINSTALL_OBFUSCATORS:-0}"

# Optional test filters
SEAL_E2E_TESTS="${SEAL_E2E_TESTS:-}"
SEAL_E2E_SKIP="${SEAL_E2E_SKIP:-}"
# Set to 1 to run seal diag E2E test (diagnostic bundle).
SEAL_DIAG_E2E="${SEAL_DIAG_E2E:-1}"
# Set to 1 to skip host-only tests that need full kernel/systemd access.
# Leave empty to let runners pick defaults (docker defaults to 1 unless SEAL_DOCKER_E2E_HOST=1).
SEAL_E2E_LIMITED_HOST="${SEAL_E2E_LIMITED_HOST:-}"
# Set to 0 to turn manifest validation errors into warnings.
SEAL_E2E_MANIFEST_STRICT="${SEAL_E2E_MANIFEST_STRICT:-1}"

# Require escalation (sudo) to avoid sandbox/permission failures.
SEAL_E2E_REQUIRE_ESCALATION="${SEAL_E2E_REQUIRE_ESCALATION:-1}"

# Runtime readiness (set to 1 to avoid HTTP listen and use ready-file mode)
SEAL_E2E_NO_LISTEN="${SEAL_E2E_NO_LISTEN:-0}"

# Isolation (docker defaults to isolate HOME unless overridden)
SEAL_E2E_ISOLATE_HOME="${SEAL_E2E_ISOLATE_HOME:-}"
SEAL_E2E_HOME_ROOT="${SEAL_E2E_HOME_ROOT:-}"
SEAL_E2E_HOME_KEEP="${SEAL_E2E_HOME_KEEP:-0}"
SEAL_E2E_SAFE_ROOTS="${SEAL_E2E_SAFE_ROOTS:-}"
SEAL_E2E_UNSAFE_EXAMPLE_ROOT="${SEAL_E2E_UNSAFE_EXAMPLE_ROOT:-0}"
# Allow SEAL_E2E_TMP_ROOT outside run root (not recommended).
SEAL_E2E_TMP_ALLOW_EXTERNAL="${SEAL_E2E_TMP_ALLOW_EXTERNAL:-0}"
# Set to 1 to force concurrent run layout (alias for SEAL_E2E_RUN_LAYOUT=concurrent).
SEAL_E2E_CONCURRENT="${SEAL_E2E_CONCURRENT:-0}"
# Run layout: auto prefers shared run root; concurrent forces per-run folder.
SEAL_E2E_RUN_LAYOUT="${SEAL_E2E_RUN_LAYOUT:-auto}"
SEAL_E2E_RUN_ID="${SEAL_E2E_RUN_ID:-}"
# Disk summary + seal-out warning (E2E-only)
SEAL_E2E_DISK_SUMMARY="${SEAL_E2E_DISK_SUMMARY:-1}"
SEAL_E2E_SEAL_OUT_WARN_GB="${SEAL_E2E_SEAL_OUT_WARN_GB:-10}"
# Auto-clean E2E run artifacts when disk warning threshold is exceeded.
SEAL_E2E_AUTO_CLEAN="${SEAL_E2E_AUTO_CLEAN:-1}"

# Reporting
SEAL_E2E_SUMMARY_PATH="${SEAL_E2E_SUMMARY_PATH:-}"
SEAL_E2E_SUMMARY_JSON_PATH="${SEAL_E2E_SUMMARY_JSON_PATH:-}"
SEAL_E2E_SUMMARY_APPEND="${SEAL_E2E_SUMMARY_APPEND:-0}"
SEAL_E2E_SUMMARY_SCOPE="${SEAL_E2E_SUMMARY_SCOPE:-all}"
SEAL_E2E_SUMMARY_KEEP="${SEAL_E2E_SUMMARY_KEEP:-20}"
SEAL_E2E_LOG_DIR="${SEAL_E2E_LOG_DIR:-}"
SEAL_E2E_LOG_TAIL_LINES="${SEAL_E2E_LOG_TAIL_LINES:-40}"
SEAL_E2E_CAPTURE_LOGS="${SEAL_E2E_CAPTURE_LOGS:-1}"
SEAL_E2E_LOG_KEEP="${SEAL_E2E_LOG_KEEP:-10}"
SEAL_E2E_RUNNER_HEARTBEAT_SEC="${SEAL_E2E_RUNNER_HEARTBEAT_SEC:-60}"
# Set to 0 to suppress "filtered" skip logs.
SEAL_E2E_LOG_FILTERED="${SEAL_E2E_LOG_FILTERED:-}"
SEAL_UI_E2E_TRACE="${SEAL_UI_E2E_TRACE:-}"
# Set to 0 to disable UI artifacts or provide a custom directory.
SEAL_UI_E2E_ARTIFACTS="${SEAL_UI_E2E_ARTIFACTS:-}"

# Rerun failed tests
SEAL_E2E_RERUN_FAILED="${SEAL_E2E_RERUN_FAILED:-0}"
SEAL_E2E_RERUN_FROM="${SEAL_E2E_RERUN_FROM:-}"
SEAL_E2E_FAIL_FAST="${SEAL_E2E_FAIL_FAST:-0}"

# Plan-only mode (print selection and exit)
SEAL_E2E_PLAN="${SEAL_E2E_PLAN:-0}"

# Setup-only mode (prepare deps and exit)
SEAL_E2E_SETUP_ONLY="${SEAL_E2E_SETUP_ONLY:-0}"

# Example handling
SEAL_E2E_COPY_EXAMPLE="${SEAL_E2E_COPY_EXAMPLE:-1}"
SEAL_E2E_EXAMPLE_ROOT="${SEAL_E2E_EXAMPLE_ROOT:-}"

# Capability overrides (comma/space separated)
SEAL_E2E_CAPS_ALLOW="${SEAL_E2E_CAPS_ALLOW:-}"
SEAL_E2E_CAPS_DENY="${SEAL_E2E_CAPS_DENY:-}"

# Strict anti-debug flags (set to 1 to enforce)
SEAL_E2E_STRICT_PROC_MEM="${SEAL_E2E_STRICT_PROC_MEM:-0}"
SEAL_E2E_STRICT_PTRACE="${SEAL_E2E_STRICT_PTRACE:-0}"
SEAL_E2E_STRICT_SNAPSHOT_GUARD="${SEAL_E2E_STRICT_SNAPSHOT_GUARD:-0}"
SEAL_E2E_STRICT_SYSLOG="${SEAL_E2E_STRICT_SYSLOG:-0}"
SEAL_E2E_STRICT_ATTACH_BASELINE="${SEAL_E2E_STRICT_ATTACH_BASELINE:-0}"
SEAL_E2E_STRICT_TOOL_BASELINE="${SEAL_E2E_STRICT_TOOL_BASELINE:-0}"
SEAL_E2E_STRICT_HOST_BASELINE="${SEAL_E2E_STRICT_HOST_BASELINE:-0}"
SEAL_E2E_STRICT_CORE_BASELINE="${SEAL_E2E_STRICT_CORE_BASELINE:-0}"

# Real dump checks (set to 1 to enable and enforce as needed)
SEAL_E2E_REAL_DUMP="${SEAL_E2E_REAL_DUMP:-0}"
SEAL_E2E_STRICT_REAL_DUMP="${SEAL_E2E_STRICT_REAL_DUMP:-0}"
